<!DOCTYPE html>
<html lang="en">

<head>


<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="Matthias Altmann">
<meta name="description" content="Secure Software Development using CI / Part II - Web Application Scanning / DAST">

<title>Secure Software Development using CI</title>

<!-- Bootstrap core CSS -->
<link href="/blog/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

<!-- Bootstrap core JavaScript -->
<script src="/blog/vendor/jquery/jquery.min.js"></script>
<script src="/blog/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

<!-- Custom fonts for this template -->
<link href="/blog/vendor/fontawesome-free-web/css/all.css" rel="stylesheet" type="text/css">
<link href='/blog/vendor/fonts-googleapis/lora.css' rel='stylesheet' type='text/css'>
<link href='/blog/vendor/fonts-googleapis/opensans.css' rel='stylesheet' type='text/css'>

<link rel="shortcut icon" href="/blog/assets/img/favicon.ico" type="image/x-icon">
<link rel="icon" href="/blog/assets/img/favicon.ico" type="image/x-icon">

<script src="/blog/vendor/jquery/jquery.min.js"></script>
<script src="/blog/vendor/gsap/gsap.min.js"></script>

<script src="/blog/vendor/highlight/highlight.pack.js"></script>
<link href="/blog/vendor/highlight/styles/default.css" rel="stylesheet" type="text/css">
<script>hljs.initHighlightingOnLoad();</script>

<link href="/blog/vendor/malihu-jquery-custom-scrollbar/jquery.mCustomScrollbar.min.css" rel="stylesheet">
<script src="/blog/vendor/malihu-jquery-custom-scrollbar/jquery.mCustomScrollbar.js"></script>

<!-- Custom styles and scripts -->
<link href="/blog/css/clean-blog.min.css" rel="stylesheet">
<script src="/blog/js/clean-blog.min.js"></script>

<link href="/blog/css/svganimations.css" rel="stylesheet">

<script src="/blog/js/sidebar.js"></script>
<link href="/blog/css/sidebar.css" rel="stylesheet">

<!-- For atom rss feed that browser can detect rss on side -->
<link href="/blog/feed.xml" type="application/atom+xml" rel="alternate" title="Sitewide Atom feed" />





</head>

<body>

<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
    <div class="container">
        <a class="navbar-brand" id="nav-link-main" href="/blog/index.html">~/sec/f00tprint</a>
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            Menu
            <i class="fa fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link" href="/blog/index.html">Posts</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/blog/germancorner.html">German Corner</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/blog/passwords/crunch/advanced/en">Last Post</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/blog/about.html">About</a>
                </li>
            </ul>
        </div>
    </div>
</nav>


<!-- Page Header -->
<header class="masthead" style="background-image:url('/blog/assets/img/post_backgrounds/home-matrix.png')">
    <div class="overlay"></div>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-md-10 mx-auto">
                <div class="page-heading">
                    <h1>Secure Software Development using CI</h1>
                    
                    <h2 class="subheading">Part II - Web Application Scanning / DAST</h2>
                    
                    
                    <span class="meta">Posted on July 17, 2018</span>
                    

                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">

        <nav id="sidebar" class="sidebar-wrapper active">
            <div class="sidebar-header">
                <h3>Table of contents</h3>
                <h4>Secure Software Development using CI</h4>
            </div>

            <ul class="list-unstyled components">
                <ul id="toc" class="section-nav">
<li class="toc-entry toc-h1"><a href="#introduction">Introduction</a></li>
<li class="toc-entry toc-h1">
<a href="#installing-owasp-zap-in-jenkins">Installing OWASP ZAP in Jenkins</a>
<ul>
<li class="toc-entry toc-h2"><a href="#stopping-old-docker-container">Stopping old docker container</a></li>
<li class="toc-entry toc-h2">
<a href="#installation">Installation</a>
<ul>
<li class="toc-entry toc-h3">
<a href="#installation-of-necessary-plugins">Installation of necessary plugins</a>
<ul>
<li class="toc-entry toc-h4"><a href="#configuring-custom-tools">Configuring Custom Tools</a></li>
<li class="toc-entry toc-h4"><a href="#configuring-the-port-for-zap">Configuring the port for ZAP</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h1">
<a href="#configuring-a-zap-job">Configuring a ZAP job</a>
<ul>
<li class="toc-entry toc-h2">
<a href="#configuring-the-target-url">Configuring the target URL</a>
<ul>
<li class="toc-entry toc-h3">
<a href="#configuring-owasp-zap">Configuring OWASP ZAP</a>
<ul>
<li class="toc-entry toc-h4"><a href="#installation-1">Installation</a></li>
<li class="toc-entry toc-h4"><a href="#configuring-proxy-zap">Configuring Proxy ZAP</a></li>
<li class="toc-entry toc-h4"><a href="#configuring-foxyproxy">Configuring FoxyProxy</a></li>
</ul>
</li>
<li class="toc-entry toc-h3">
<a href="#example-application-xss">Example application XSS</a>
<ul>
<li class="toc-entry toc-h4"><a href="#jenkins-session-properties">Jenkins Session Properties</a></li>
<li class="toc-entry toc-h4"><a href="#checking-the-vulnerability-in-the-example-application">Checking the vulnerability in the Example Application</a></li>
<li class="toc-entry toc-h4"><a href="#configuring-scan-policy">Configuring Scan Policy</a></li>
<li class="toc-entry toc-h4"><a href="#xss-scan">XSS Scan</a></li>
<li class="toc-entry toc-h4"><a href="#jenkins-attack-mode">Jenkins Attack Mode</a></li>
<li class="toc-entry toc-h4"><a href="#jenkins-report">Jenkins Report</a></li>
<li class="toc-entry toc-h4"><a href="#final-scan">Final Scan</a></li>
</ul>
</li>
<li class="toc-entry toc-h3">
<a href="#authentication">Authentication</a>
<ul>
<li class="toc-entry toc-h4"><a href="#owasp-juice-shop">OWASP Juice Shop</a></li>
<li class="toc-entry toc-h4">
<a href="#username--password-parameter">Username / Password Parameter</a>
<ul>
<li class="toc-entry toc-h5"><a href="#logged-in-string">Logged-in String</a></li>
<li class="toc-entry toc-h5"><a href="#logged-out-string">Logged-out String</a></li>
</ul>
</li>
<li class="toc-entry toc-h4"><a href="#missing-data">Missing data</a></li>
<li class="toc-entry toc-h4"><a href="#start-scan">Start Scan</a></li>
</ul>
</li>
<li class="toc-entry toc-h3">
<a href="#owasp-web-goat">OWASP Web Goat</a>
<ul>
<li class="toc-entry toc-h4"><a href="#creating-a-user">Creating a user</a></li>
<li class="toc-entry toc-h4"><a href="#logged-in--logged-out-indicators">Logged-in / Logged-out Indicators</a></li>
<li class="toc-entry toc-h4"><a href="#final-setting-webgoat">Final setting WebGoat</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#best-practices">Best Practices</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#summary">Summary</a></li>
</ul>
            </ul>

        </nav>

        <div class="row">
            <div class="col-lg-8 col-md-10 mx-auto">
                
                <button type="button" id="sidebarCollapse" class="btn btn-primary-sm btn btn-block">
                    <i class="fas fa-align-left"></i>
                    <span>Toggle Table of Contents</span>
                </button>
                
                <br>
                <h1 id="introduction">
<a class="anchor" href="#introduction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introduction</h1>

<p>The [last post] (/blog/securecode/deps/en) showed how we can find and fix insecure dependencies in a project.
In addition to the problem of dependencies issues to fix, which can be present in a large amount in a project, there is another way to harden your own code.</p>

<p>In a running application on the Internet, there is a “noise floor”.
That means, any application that presents itself in public is exposed to certain attacks after some time. This can come from botnets, but also people who want to “test”, whether you can get something from the page through hacking.</p>

<p>In order to arm your own application against such attacks before the release, there are <strong>DAST systems</strong>, short for ‘Dynamic Application Security Testing’. Here, a tool tries to execute different attack patterns from the outside with different inputs and then evaluates the results for potential vulnerabilities. In principle, this is exactly what the later malicious attacker or botnet is trying to use against the application.
This article differs from the last one in that it does not analyze code, but unleashes a “real” attacker and possible attack requests on the own application.</p>

<p>A popular DAST system for doing this is the open source tool <a href="https://www.owasp.org/index.php/OWASP_Zed_Attack_Proxy_Project" target="_blank" rel="noopener noreferrer"><strong>OWASP ZAP</strong></a>.</p>

<p>The following describes how to integrate OWASP ZAP into Jenkins. Many descriptions are based on the great documentation <a href="https://www.we45.com/blog/how-to-integrate-zap-into-jenkins-ci-pipeline-we45-blog" target="_blank" rel="noopener noreferrer">Jenkins at your Service! Integrating ZAP in Continuous Delivery</a>:</p>

<p>The individual sections are divided into:</p>

<ul>
  <li><a href="#installing-owasp-zap-in-jenkins"><strong>Installing OWASP ZAP in Jenkins</strong></a></li>
  <li><a href="#configuring-a-zap-job"><strong>Configuring a ZAP job</strong></a></li>
  <li><a href="#summary"><strong>Summary of the Blog</strong></a></li>
</ul>

<p>The steps described here have been performed on a Mac OS X. This applies in particular to the chapter where OWASP ZAP is installed as a desktop application.
You can also perform the steps on another operating system. However, for this you have to look up the corresponding command line equivalents in another OS.</p>

<h1 id="installing-owasp-zap-in-jenkins">
<a class="anchor" href="#installing-owasp-zap-in-jenkins" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installing OWASP ZAP in Jenkins</h1>

<h2 id="stopping-old-docker-container">
<a class="anchor" href="#stopping-old-docker-container" aria-hidden="true"><span class="octicon octicon-link"></span></a>Stopping old docker container</h2>

<p>Those who follow from the <a href="/blog/securecode/deps/en">old chapter</a>:
For the following explanations, we do not need the git server anymore. We can stop it with:</p>

<pre><code class="bash">docker stop &lt;containerid_gitserver&gt;
</code></pre>

<h2 id="installation">
<a class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>Next we install OWASP ZAP in Jenkins.</p>

<h3 id="installation-of-necessary-plugins">
<a class="anchor" href="#installation-of-necessary-plugins" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation of necessary plugins</h3>

<p>For installation, we use the Docker infrastructure, which we described in the <a href="/blog/securecode/deps/en">last chapter</a>.</p>

<p>Next we need:</p>

<ul>
  <li>the official ‘OWASP ZAP Plugin’, which we will use for the scans against our application</li>
  <li>the ‘Custom Tool Plugin’ - for easy installation and</li>
  <li>the ‘HTML Publisher Plugin’, to view the results in the builds.</li>
</ul>

<p>To do this, follow these steps:</p>

<p><img src="/blog/assets/img/secure-code-ci/owaspzapinstallation1.png" alt="owaspzapinstallation1">
<img src="/blog/assets/img/secure-code-ci/owaspzapinstallation2.png" alt="owaspzapinstallation2" width="100%">
<img src="/blog/assets/img/secure-code-ci/owaspzapinstallation3.png" alt="owaspzapinstallation3" width="100%">
<img src="/blog/assets/img/secure-code-ci/owaspzapinstallation4.png" alt="owaspzapinstallation4" width="100%">
<img src="/blog/assets/img/secure-code-ci/owaspzapinstallation5.png" alt="owaspzapinstallation5" width="100%"></p>

<p>Click on ‘Official OWASP ZAP’:</p>

<p><img src="/blog/assets/img/secure-code-ci/owaspzapinstallation7.png" alt="owaspzapinstallation7" width="100%"></p>

<p>Also choose ‘Custom Tool’. We can do that via the filter field in the top right corner. Afterwards we click on ‘Download now and install after restart’ and ‘Restart Jenkins when installation is complete and no jobs are running’:</p>

<p><img src="/blog/assets/img/secure-code-ci/customtoolsinstallation1.png" alt="customtoolsinstallation1">
<img src="/blog/assets/img/secure-code-ci/customtoolsinstallation2.png" alt="customtoolsinstallation2" width="100%">
<img src="/blog/assets/img/secure-code-ci/customtoolsinstallation3.png" alt="customtoolsinstallation3" width="100%">
<img src="/blog/assets/img/secure-code-ci/customtoolsinstallation4.png" alt="customtoolsinstallation4" width="100%"></p>

<p>We now go to the standard Jenkins page:</p>

<p><img src="/blog/assets/img/secure-code-ci/owaspzapinstallation9.png" alt="owaspzapinstallation9">
<img src="/blog/assets/img/secure-code-ci/owaspzapinstallation10.png" alt="owaspzapinstallation10" width="100%"></p>

<p>After some time, the login screen of Jenkins should reappear and you can log in.</p>

<p><img src="/blog/assets/img/secure-code-ci/loginafterrestart.png" alt="loginafterrestart" width="100%"></p>

<h4 id="configuring-custom-tools">
<a class="anchor" href="#configuring-custom-tools" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuring Custom Tools</h4>

<p>We are looking for the installation package ‘OWASP ZAP 2.7.0’ for Linux:</p>

<p>On the <a href="https://github.com/zaproxy/zaproxy/releases/tag/2.7.0" target="_blank" rel="noopener noreferrer">GitHub release 2.7.0 page</a> you can find the link to the linux release:
<a href="https://github.com/zaproxy/zaproxy/releases/download/2.7.0/ZAP_2.7.0_Linux.tar.gz" target="_blank" rel="noopener noreferrer">https://github.com/zaproxy/zaproxy/releases/download/2.7.0/ZAP_2.7.0_Linux.tar.gz</a></p>

<p>And set it as an installation source:</p>

<p><img src="/blog/assets/img/secure-code-ci/installowaspzapbycustomtools1.png" alt="installowaspzapbycustomtools1">
<img src="/blog/assets/img/secure-code-ci/installowaspzapbycustomtools2.png" alt="installowaspzapbycustomtools2" width="100%">
<img src="/blog/assets/img/secure-code-ci/installowaspzapbycustomtools3.png" alt="installowaspzapbycustomtools3" width="100%">
<img src="/blog/assets/img/secure-code-ci/installowaspzapbycustomtools4.png" alt="installowaspzapbycustomtools4" width="100%"></p>

<p>As input under ‘custom tool’ we use:</p>

<ul>
  <li>‘custom tool’</li>
  <li>name : <code class="language-plaintext highlighter-rouge">ZAP_2.7.0</code>
</li>
  <li>install automatically</li>
  <li>download URL for binary archive: <code class="language-plaintext highlighter-rouge">https://github.com/zaproxy/zaproxy/releases/download/2.7.0/ZAP_2.7.0_Linux.tar.gz</code>
</li>
  <li>subdirectory of extracted archive: <code class="language-plaintext highlighter-rouge">ZAP_2.7.0</code>
</li>
</ul>

<p><img src="/blog/assets/img/secure-code-ci/installowaspzapbycustomtools5.png" alt="installowaspzapbycustomtools5" width="100%"></p>

<p>and finally click on ‘Save’.</p>

<h4 id="configuring-the-port-for-zap">
<a class="anchor" href="#configuring-the-port-for-zap" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuring the port for ZAP</h4>

<p><img src="/blog/assets/img/secure-code-ci/managejenkins.png" alt="managejenkins">
<img src="/blog/assets/img/secure-code-ci/configuresystem.png" alt="configuresystem"></p>

<p>Under ‘ZAP’:</p>

<p>We set the port to something rare, like 12123:</p>

<ul>
  <li>default host: <code class="language-plaintext highlighter-rouge">localhost</code>
</li>
  <li>default port: <code class="language-plaintext highlighter-rouge">12123</code>
</li>
</ul>

<p><img src="/blog/assets/img/secure-code-ci/configowaspzapport.png" alt="configowaspzapport" width="100%"></p>

<p>‘Save’</p>

<h1 id="configuring-a-zap-job">
<a class="anchor" href="#configuring-a-zap-job" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuring a ZAP job</h1>

<p>Now we create our first ‘OWASP ZAP scan job’:</p>

<p><img src="/blog/assets/img/secure-code-ci/newitem.png" alt="newitem"></p>

<p>Enter ‘zap_scan_demo’ and click ‘Ok’.</p>

<p><img src="/blog/assets/img/secure-code-ci/zapscandemo1.png" alt="zapscandemo1">
<img src="/blog/assets/img/secure-code-ci/zapscandemo2.png" alt="zapscandemo2" width="100%">
<img src="/blog/assets/img/secure-code-ci/zapscandemo3.png" alt="zapscandemo3" width="100%">
<img src="/blog/assets/img/secure-code-ci/zapscandemo4.png" alt="zapscandemo4" width="100%"></p>

<p>Now for ‘Tool Selection’: <code class="language-plaintext highlighter-rouge">ZAP_2.7.0</code>.</p>

<p><img src="/blog/assets/img/secure-code-ci/zapscandemo6.png" alt="zapscandemo6" width="100%">
<img src="/blog/assets/img/secure-code-ci/zapscandemo7.png" alt="zapscandemo7" width="100%">
<img src="/blog/assets/img/secure-code-ci/zapscandemo8.png" alt="zapscandemo8" width="100%">
<img src="/blog/assets/img/secure-code-ci/zapscandemo9.png" alt="zapscandemo9" width="100%">
<img src="/blog/assets/img/secure-code-ci/zapscandemo10.png" alt="zapscandemo10" width="100%"></p>

<p>We deliver where we want OWASP ZAP to be installed:</p>

<ul>
  <li>path: <code class="language-plaintext highlighter-rouge">/var/jenkins_home/owaspzap</code>
</li>
  <li>persist session: <code class="language-plaintext highlighter-rouge">owasp_webgoat_zap_session</code>
</li>
</ul>

<p><img src="/blog/assets/img/secure-code-ci/zapscandemo11.png" alt="zapscandemo11" width="100%"></p>

<h2 id="configuring-the-target-url">
<a class="anchor" href="#configuring-the-target-url" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuring the target URL</h2>

<p>Next, we need to specify the target URL, the URL we want to attack.</p>

<p>For this we need the following information:</p>

<ul>
  <li>session properties</li>
  <li>include in context: which URLs are in the test frame? We do not want to scan URLs outside this and which may be liable to prosecution.</li>
  <li>authentification: Here you can set how the scanner can log in to the application and how it notices this. Any application with a login that you want to test inside needs this setting.</li>
  <li>attack mode</li>
  <li>starting point: The address from which we want to start the scan.</li>
  <li>spider scan: Here we can choose if the scanner tries to find further pages using existing links in the root page. This makes sense, as we don’t want to test just one page.</li>
  <li>active scan: Here we can select the scan policy. As long as we haven’t created one yet, the default policy of OWASP ZAP will be taken.</li>
  <li>finalize run: Here you can define how the report should be generated.</li>
</ul>

<p>Using a small sample application that is vulnerable to XSS, I’ll first explain how we can configure each item. Then I’ll go into the topic of authentication in applications and how to set them in the scanner. With the shown it should be possible to configure a larger project at the end.</p>

<h3 id="configuring-owasp-zap">
<a class="anchor" href="#configuring-owasp-zap" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuring OWASP ZAP</h3>

<h4 id="installation-1">
<a class="anchor" href="#installation-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h4>

<p>To make the settings easier, we install the original application of OWASP ZAP locally.</p>

<p>To be able to understand everything better we use a fixed version : <code class="language-plaintext highlighter-rouge">2.7.0</code>. Therefore we use a specific git hash in the URL to install specifically version <code class="language-plaintext highlighter-rouge">2.7.0</code>:</p>

<pre><code class="bash">brew cask install https://raw.githubusercontent.com/caskroom/homebrew-cask/645dbb8228ec2f1f217ed1431e188687aac13ca5/Casks/owasp-zap.rb
</code></pre>

<p><img src="/blog/assets/img/secure-code-ci/installowaspzapbrewcask.png" alt="installowaspzapbrewcask" width="100%"></p>

<p>You can now launch the application from your Mac by typing <code class="language-plaintext highlighter-rouge">OWASP ZAP</code> into Spotlight:</p>

<p><img src="/blog/assets/img/secure-code-ci/startowaspzap.png" alt="startowaspzap" width="100%"></p>

<p>Now click ‘<code class="language-plaintext highlighter-rouge">No, I do not want to persist this session at this moment in time</code>’:</p>

<p><img src="/blog/assets/img/secure-code-ci/notpersistingsessionowaspzap.png" alt="notpersistingsessionowaspzap" width="100%"></p>

<p>Then select ‘Start’:</p>

<p><img src="/blog/assets/img/secure-code-ci/notpersistingsessionowaspzap2.png" alt="notpersistingsessionowaspzap2" width="100%"></p>

<h4 id="configuring-proxy-zap">
<a class="anchor" href="#configuring-proxy-zap" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuring Proxy ZAP</h4>

<p>We click on the little wheel:</p>

<p><img src="/blog/assets/img/secure-code-ci/preferencesowaspzap1.png" alt="preferencesowaspzap1" width="100%"></p>

<p>and set the following data for ‘Local Proxies’:</p>

<ul>
  <li>address: <code class="language-plaintext highlighter-rouge">127.0.0.1</code>
</li>
  <li>port: <code class="language-plaintext highlighter-rouge">9000</code>
</li>
</ul>

<p>and save with <code class="language-plaintext highlighter-rouge">Ok</code>.</p>

<h4 id="configuring-foxyproxy">
<a class="anchor" href="#configuring-foxyproxy" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuring FoxyProxy</h4>

<p>In the browser we configure a proxy for <code class="language-plaintext highlighter-rouge">localhost:9000</code>.</p>

<p>For that, you can use the extension FoxyProxy in Firefox (under Add-ons) as well as in Chrome (under Extensions).</p>

<p>First we install the extension.</p>

<p><img src="/blog/assets/img/secure-code-ci/foxyproxyfirefox.png" alt="foxyproxyfirefox" width="100%"></p>

<p>Then we open it by clicking on the icon at the top right of the browser:</p>

<p><img src="/blog/assets/img/secure-code-ci/foxyproxyconfig1.png" alt="foxyproxyconfig1"></p>

<p>And set this:</p>

<p><img src="/blog/assets/img/secure-code-ci/foxyproxyconfig2.png" alt="foxyproxyconfig2">
<img src="/blog/assets/img/secure-code-ci/foxyproxyconfig3.png" alt="foxyproxyconfig3"></p>

<ul>
  <li>Proxy Type: <code class="language-plaintext highlighter-rouge">HTTP</code>
</li>
  <li>Title or Description (optional): <code class="language-plaintext highlighter-rouge">OWASP ZAP 127.0.0.1:9000</code>
</li>
  <li>IP address, DNS name, server name: <code class="language-plaintext highlighter-rouge">127.0.0.1</code>
</li>
  <li>Port: <code class="language-plaintext highlighter-rouge">9000</code>
</li>
</ul>

<p><img src="/blog/assets/img/secure-code-ci/foxyproxyconfig4.png" alt="foxyproxyconfig4" width="100%"></p>

<p><code class="language-plaintext highlighter-rouge">Save</code></p>

<p><img src="/blog/assets/img/secure-code-ci/foxyproxyconfig5.png" alt="foxyproxyconfig5" width="100%"></p>

<p>Now we can select the proxy:</p>

<p><img src="/blog/assets/img/secure-code-ci/foxyproxyconfig1.png" alt="foxyproxyconfig1">
<img src="/blog/assets/img/secure-code-ci/foxyproxyconfig6.png" alt="foxyproxyconfig6" width="100%"></p>

<p>The icon changes to:</p>

<p><img src="/blog/assets/img/secure-code-ci/foxyproxyconfig7.png" alt="foxyproxyconfig7"></p>

<p>Now the traffic runs through the proxy.</p>

<h3 id="example-application-xss">
<a class="anchor" href="#example-application-xss" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example application XSS</h3>

<p>We launch an application that is vulnerable to XSS:</p>

<pre><code class="bash">docker run -ti --rm -p 127.0.0.1:1185:1185 \
-d secf00tprint/victim_easy_xss_server
</code></pre>

<p>When we open the application we see text input fields for comments. Here you can inject code:</p>

<pre><code class="bash">open http://127.0.0.1:1185
</code></pre>

<p><img src="/blog/assets/img/secure-code-ci/victim_easy_xss1.png" alt="victim_easy_xss1"></p>

<p>We determine the IP on the docker network:</p>

<pre><code class="bash">docker inspect &lt;containerid_victim_easy_xss_server&gt;|grep "IPA"
</code></pre>

<h4 id="jenkins-session-properties">
<a class="anchor" href="#jenkins-session-properties" aria-hidden="true"><span class="octicon octicon-link"></span></a>Jenkins Session Properties</h4>

<p>Then we enter under ‘Session Properties’:</p>

<ul>
  <li>Context Name: <code class="language-plaintext highlighter-rouge">zap_scan_demo</code>
</li>
  <li>Include in Context: <code class="language-plaintext highlighter-rouge">http://&amp;#x3C;determined_IP&amp;#x3E;:1185/.*</code>, e.g. <code class="language-plaintext highlighter-rouge">http://172.17.0.4:1185/.*</code>
</li>
</ul>

<p><img src="/blog/assets/img/secure-code-ci/sessionpropertiessimplexss_owaspzap.png" alt="sessionpropertiessimplexss_owaspzap" width="100%"></p>

<p>Under ‘Attack Mode’ we enter the root URL:</p>

<pre><code class="bash">http://&lt;determined_IP&gt;:1185/ 
</code></pre>

<p>e.g.</p>

<pre><code class="bash">http://172.17.0.4:1185/ 
</code></pre>

<p><img src="/blog/assets/img/secure-code-ci/sessionpropertiessimplexss_owaspzap2.png" alt="sessionpropertiessimplexss_owaspzap2" width="100%"></p>

<p>‘Save’</p>

<p>Then we build the item for the first time.</p>

<p>‘Build Now’</p>

<p><img src="/blog/assets/img/secure-code-ci/buildnow.png" alt="buildnow"></p>

<p><img src="/blog/assets/img/secure-code-ci/sessionpropertiessimplexss_owaspzap3.png" alt="sessionpropertiessimplexss_owaspzap3" width="100%"></p>

<p>Then ZAP should be installed in the folder <code class="language-plaintext highlighter-rouge">/var/jenkins_home/owaspzap</code>.</p>

<h4 id="checking-the-vulnerability-in-the-example-application">
<a class="anchor" href="#checking-the-vulnerability-in-the-example-application" aria-hidden="true"><span class="octicon octicon-link"></span></a>Checking the vulnerability in the Example Application</h4>

<p>If we start our proxy and call <code class="language-plaintext highlighter-rouge">http://127.0.0.1:1185</code> in the browser,</p>

<p><img src="/blog/assets/img/secure-code-ci/foxyproxyconfig7.png" alt="foxyproxyconfig7">
<img src="/blog/assets/img/secure-code-ci/xss_easy_vuln1.png" alt="xss_easy_vuln1" width="100%"></p>

<p>this should appear in OWASP ZAP:</p>

<p><img src="/blog/assets/img/secure-code-ci/xss_easy_vuln2a.png" alt="xss_easy_vuln2a" width="100%">
<img src="/blog/assets/img/secure-code-ci/xss_easy_vuln2b.png" alt="xss_easy_vuln2b" width="100%"></p>

<p>We now go back to the browser and enter the following in the GET-field:</p>

<ul>
  <li>Comment (using GET): <code class="language-plaintext highlighter-rouge">Test</code>
</li>
</ul>

<p>‘Show’</p>

<p>Result:</p>

<p>The URL shows <code class="language-plaintext highlighter-rouge">http://127.0.0.1:1185/?comment=Test&amp;enter_comment=Show</code> and the comment appears:</p>

<p><img src="/blog/assets/img/secure-code-ci/xss_easy_vuln3.png" alt="xss_easy_vuln3" width="100%"></p>

<p>If we click on ‘Back’, enter</p>

<pre><code class="javascript">&lt;script&gt;alert(1)&lt;/script&gt;
</code></pre>

<p>x and click on ‘Save’, we see a pop-up:</p>

<p><img src="/blog/assets/img/secure-code-ci/xss_easy_vuln4.png" alt="xss_easy_vuln4" width="100%"></p>

<p>This means the application is vulnerable to <a href="https://en.wikipedia.org/wiki/Cross-site_scripting" target="_blank" rel="noopener noreferrer">XSS</a>.</p>

<p>OWASP ZAP should find this. Let’s take a closer look now:</p>

<h4 id="configuring-scan-policy">
<a class="anchor" href="#configuring-scan-policy" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuring Scan Policy</h4>

<p>We can use the icon with the mixer to set how we want to scan:</p>

<p><img src="/blog/assets/img/secure-code-ci/owaspzapscanpolicy1.png" alt="owaspzapscanpolicy1" width="100%"></p>

<p>First we click on ‘Add’</p>

<p><img src="/blog/assets/img/secure-code-ci/owaspzapscanpolicy2.png" alt="owaspzapscanpolicy2" width="100%"></p>

<p>and select the following values:</p>

<ul>
  <li>Scan policy</li>
  <li>Policy: <code class="language-plaintext highlighter-rouge">XSS</code>
</li>
  <li>Default alert threshold: <code class="language-plaintext highlighter-rouge">Medium</code>
</li>
  <li>Default attack strength: <code class="language-plaintext highlighter-rouge">Low</code>
</li>
  <li>Information gathering: Threshold: <code class="language-plaintext highlighter-rouge">OFF</code>, Strength: <code class="language-plaintext highlighter-rouge">Default</code>
</li>
  <li>Server security: Threshold: <code class="language-plaintext highlighter-rouge">OFF</code>, Strength: <code class="language-plaintext highlighter-rouge">Default</code>
</li>
</ul>

<p><img src="/blog/assets/img/secure-code-ci/owaspzapscanpolicy3.png" alt="owaspzapscanpolicy3" width="100%"></p>

<p>Under ‘Injection’ we set everything to ‘Threshold’: <code class="language-plaintext highlighter-rouge">OFF</code> and Strength: <code class="language-plaintext highlighter-rouge">Default</code>, except entries with cross-site scripting. These we set to <code class="language-plaintext highlighter-rouge">Low</code>:</p>

<p><img src="/blog/assets/img/secure-code-ci/owaspzapscanpolicy4.png" alt="owaspzapscanpolicy4" width="100%"></p>

<p>‘Miscellaneous’, ‘External Redirect’, ‘Threshold’ we switch to <code class="language-plaintext highlighter-rouge">OFF</code>, Strength to <code class="language-plaintext highlighter-rouge">Default</code> and ‘Script Active Scan Rules’ to <code class="language-plaintext highlighter-rouge">Low</code>, <code class="language-plaintext highlighter-rouge">Default</code>:</p>

<p><img src="/blog/assets/img/secure-code-ci/owaspzapscanpolicy5.png" alt="owaspzapscanpolicy5" width="100%"></p>

<p>‘Ok’</p>

<p>Then ‘XSS’ and ‘Export’ and save the file as ‘XSS.policy’:</p>

<p><img src="/blog/assets/img/secure-code-ci/owaspzapscanpolicy6.png" alt="owaspzapscanpolicy6" width="100%">
<img src="/blog/assets/img/secure-code-ci/owaspzapscanpolicy7.png" alt="owaspzapscanpolicy7" width="100%">
<img src="/blog/assets/img/secure-code-ci/owaspzapscanpolicy8.png" alt="owaspzapscanpolicy8" width="100%"></p>

<p>‘Save’</p>

<p>If we look at the file, we see that it is an XML file that adheres to a certain format.</p>

<p><img src="/blog/assets/img/secure-code-ci/owaspzapscanpolicy8b.png" alt="owaspzapscanpolicy8b"></p>

<p>The individual entries can be looked up:</p>

<p><a href="https://github.com/zaproxy/zaproxy/wiki/ZAP-API-Scan#configuration-file" target="_blank" rel="noopener noreferrer">Policy abbreviations for active and passive scans</a></p>

<p><img src="/blog/assets/img/secure-code-ci/owaspzapscanpolicy9.png" alt="owaspzapscanpolicy9"></p>

<p>We remember the location of the file where we put it, because we need it afterwards for Jenkins.</p>

<h4 id="xss-scan">
<a class="anchor" href="#xss-scan" aria-hidden="true"><span class="octicon octicon-link"></span></a>XSS Scan</h4>

<p>We now look in the ‘History’ of OWASP ZAP for the request in which we entered ‘Test’:</p>

<p><img src="/blog/assets/img/secure-code-ci/xss_easy_vuln5.png" alt="xss_easy_vuln5" width="100%"></p>

<p>and select ‘Attack’, ‘Active Scan’:</p>

<p><img src="/blog/assets/img/secure-code-ci/xss_easy_vuln6.png" alt="xss_easy_vuln6" width="100%"></p>

<p>Under ‘Policy’ we select ‘XSS’:</p>

<p><img src="/blog/assets/img/secure-code-ci/xss_easy_vuln7.png" alt="xss_easy_vuln7" width="100%"></p>

<p>and click on ‘Start Scan’.</p>

<p><img src="/blog/assets/img/secure-code-ci/xss_easy_vuln8.png" alt="xss_easy_vuln8" width="100%"></p>

<p>If we now click on ‘Alerts’</p>

<p><img src="/blog/assets/img/secure-code-ci/xss_easy_vuln9.png" alt="xss_easy_vuln9" width="100%"></p>

<p>we can see that an XSS has been found:</p>

<p><img src="/blog/assets/img/secure-code-ci/xss_easy_vuln10.png" alt="xss_easy_vuln10" width="100%"></p>

<p>We also want to reproduce this finding in Jenkins.</p>

<h4 id="jenkins-attack-mode">
<a class="anchor" href="#jenkins-attack-mode" aria-hidden="true"><span class="octicon octicon-link"></span></a>Jenkins Attack Mode</h4>

<p>First, we need to copy the policy in Jenkins. To do this, type the following command on the command line in the directory where <code class="language-plaintext highlighter-rouge">XSS.policy</code> was placed:</p>

<pre><code class="bash">docker cp XSS.policy &lt;containerid_jenkins&gt;:/var/jenkins_home/owaspzap/policies/
</code></pre>

<p>If we now open the configuration page OWASP ZAP in Jenkins we can select the policy.</p>

<p>Attack Mode:</p>

<ul>
  <li>Starting point: <code class="language-plaintext highlighter-rouge">http://&amp;#x3C;determined_IP&amp;#x3E;:1185/?comment=test&amp;#x26;enter_comment=Show</code> e.g. <code class="language-plaintext highlighter-rouge">http://172.17.0.3:1185/?comment=test&amp;enter_comment=Show</code>
</li>
  <li>Spider Scan: True</li>
  <li>Recurse: True</li>
  <li>Subtree Only: Max Children to Crawl: <code class="language-plaintext highlighter-rouge">2</code>
</li>
  <li>Active Scan</li>
  <li>Policy: <code class="language-plaintext highlighter-rouge">XSS</code> wählen</li>
</ul>

<p><img src="/blog/assets/img/secure-code-ci/owaspzapattackmode1.png" alt="owaspzapattackmode1" width="100%"></p>

<h4 id="jenkins-report">
<a class="anchor" href="#jenkins-report" aria-hidden="true"><span class="octicon octicon-link"></span></a>Jenkins Report</h4>

<p>To generate a corresponding report,</p>

<p>we set ‘Finalize Run’:</p>

<ul>
  <li>Generate Reports: True</li>
  <li>Clean Workspace Reports: True</li>
  <li>Filename: <code class="language-plaintext highlighter-rouge">JENKINS_ZAP_VULNERABILITY_REPORT_${BUILD_ID}</code>
</li>
  <li>Generate Report: True</li>
  <li>Format: choose xml and html</li>
</ul>

<p><img src="/blog/assets/img/secure-code-ci/owaspzapreport1.png" alt="owaspzapreport1" width="100%"></p>

<p>Under ‘Add post-build action’, ‘Archive the artifacts’:</p>

<p><img src="/blog/assets/img/secure-code-ci/owaspzapreport2.png" alt="owaspzapreport2"></p>

<ul>
  <li>Archive the artifacts</li>
  <li>Files to archive: <code class="language-plaintext highlighter-rouge">logs/*,reports/*</code>
</li>
</ul>

<p><img src="/blog/assets/img/secure-code-ci/owaspzapreport3.png" alt="owaspzapreport3" width="100%"></p>

<p>and ‘Add post-build action’, ‘Publish HTML Reports’:</p>

<p><img src="/blog/assets/img/secure-code-ci/owaspzapreport4.png" alt="owaspzapreport4" width="100%"></p>

<p>‘Add’</p>

<p><img src="/blog/assets/img/secure-code-ci/owaspzapreport5.png" alt="owaspzapreport5" width="100%"></p>

<ul>
  <li>Publish HTML reports: Reports</li>
  <li>HTML directory to archive: <code class="language-plaintext highlighter-rouge">reports/</code>
</li>
  <li>Index page[s]: <code class="language-plaintext highlighter-rouge">JENKINS_ZAP_VULNERABILITY_REPORT_${BUILD_ID}</code>
</li>
  <li>Report title: <code class="language-plaintext highlighter-rouge">ZAP Scan Demo</code>
</li>
</ul>

<p><img src="/blog/assets/img/secure-code-ci/owaspzapreport6.png" alt="owaspzapreport6" width="100%"></p>

<p>and finally we click on ‘Save’.</p>

<h4 id="final-scan">
<a class="anchor" href="#final-scan" aria-hidden="true"><span class="octicon octicon-link"></span></a>Final Scan</h4>

<p>To start the final scan we select ‘Build now’:</p>

<p><img src="/blog/assets/img/secure-code-ci/buildnow.png" alt="buildnow"></p>

<p>The performed scan should find the XSS:</p>

<p><img src="/blog/assets/img/secure-code-ci/owaspzapscandemofinal1.png" alt="owaspzapscandemofinal1" width="100%">
<img src="/blog/assets/img/secure-code-ci/owaspzapscandemofinal2.png" alt="owaspzapscandemofinal2" width="100%">
<img src="/blog/assets/img/secure-code-ci/owaspzapscandemofinal3.png" alt="owaspzapscandemofinal3" width="100%"></p>

<h3 id="authentication">
<a class="anchor" href="#authentication" aria-hidden="true"><span class="octicon octicon-link"></span></a>Authentication</h3>

<p>In the following section I will explain how to set up authentication. To make it clearer I take 2 applications: OWASP WebGoat and OWASP Juice Shop:</p>

<h4 id="owasp-juice-shop">
<a class="anchor" href="#owasp-juice-shop" aria-hidden="true"><span class="octicon octicon-link"></span></a>OWASP Juice Shop</h4>

<p>To start this application we type in the following command on the command line</p>

<pre><code class="bash">docker run --rm -p 127.0.0.1:3000:3000 -d bkimminich/juice-shop
</code></pre>

<p>and open the started application in the browser:</p>

<pre><code class="bash">open http://127.0.0.1:3000
</code></pre>

<p>The proxy for OWASP ZAP should be set in the browser (cf. chapter <a href="#configuring-foxyproxy">Configuring FoxyProxy</a>).</p>

<p>Now we go to the login mask:</p>

<p><img src="/blog/assets/img/secure-code-ci/juicyshop1.png" alt="juicyshop1" width="100%">
<img src="/blog/assets/img/secure-code-ci/juicyshop2.png" alt="juicyshop2" width="100%"></p>

<p>We’ll sign up with:</p>

<ul>
  <li>User: <code class="language-plaintext highlighter-rouge">' or 1=1;--</code>
</li>
  <li>Password: anything</li>
</ul>

<p>In the ‘History’ in OWASP ZAP we should see a POST:</p>

<p><img src="/blog/assets/img/secure-code-ci/juicyshop3.png" alt="juicyshop3" width="100%"></p>

<h4 id="username--password-parameter">
<a class="anchor" href="#username--password-parameter" aria-hidden="true"><span class="octicon octicon-link"></span></a>Username / Password Parameter</h4>

<p>The OWASP-ZAP plugin in Jenkins needs for a successful authentication which parameters are used for the login:</p>

<p><img src="/blog/assets/img/secure-code-ci/juicyshop3b.png" alt="juicyshop3b" width="100%"></p>

<p>In this case, you can determine them from the POST request:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">{"email":"' or 1=1;--","password":"p"}</code></li>
</ul>

<p><img src="/blog/assets/img/secure-code-ci/juicyshop3a.png" alt="juicyshop3a" width="100%"></p>

<p>We can put that down in Jenkins:</p>

<p><img src="/blog/assets/img/secure-code-ci/juicyshop3c.png" alt="juicyshop3c" width="100%"></p>

<p>We can also take the login credentials</p>

<ul>
  <li>Username: <code class="language-plaintext highlighter-rouge">' or 1=1;--</code>
</li>
  <li>Password: beliebig</li>
</ul>

<p><img src="/blog/assets/img/secure-code-ci/juicyshop3d.png" alt="juicyshop3d" width="100%"></p>

<p>and the login URL from ZAP:</p>

<p><code class="language-plaintext highlighter-rouge">http://127.0.0.1:3000/rest/user/login</code></p>

<p><img src="/blog/assets/img/secure-code-ci/juicyshop3e.png" alt="juicyshop3e" width="100%"></p>

<p>Whereby we still have to exchange the IP with the IP which is present in the Docker network, e.g.:</p>

<p><code class="language-plaintext highlighter-rouge">http://172.17.0.3:3000/rest/user/login</code></p>

<p>We’ll put that in Jenkins:</p>

<p><img src="/blog/assets/img/secure-code-ci/juicyshop3f.png" alt="juicyshop3f" width="100%"></p>

<h5 id="logged-in-string">
<a class="anchor" href="#logged-in-string" aria-hidden="true"><span class="octicon octicon-link"></span></a>Logged-in String</h5>

<p>To determine when the user is logged in, a logged-in string must be specified in Jenkins:</p>

<p><img src="/blog/assets/img/secure-code-ci/juicyshop4.png" alt="juicyshop4" width="100%"></p>

<p>If you click on the question mark on the right you will see how it is determined:</p>

<blockquote>
  <p>The Logged in indicator, when present in a response message (either the header or the body), signifies that the response message corresponds to an authenticated request.</p>
</blockquote>

<p><img src="/blog/assets/img/secure-code-ci/juicyshop5.png" alt="juicyshop5" width="100%"></p>

<p>Therefore we look at the response in OWASP ZAP for a successful login:</p>

<p><img src="/blog/assets/img/secure-code-ci/juicyshop5b.png" alt="juicyshop5b" width="100%">
<img src="/blog/assets/img/secure-code-ci/juicyshop6.png" alt="juicyshop6" width="100%"></p>

<p>And save this response under the name <code class="language-plaintext highlighter-rouge">response.raw.out</code>:</p>

<p>Right mouse button, ‘Save raw’, ‘Response’, ‘All’:</p>

<p><img src="/blog/assets/img/secure-code-ci/juicyshop6aa.png" alt="juicyshop6aa" width="100%">
<img src="/blog/assets/img/secure-code-ci/juicyshop6ab.png" alt="juicyshop6ab" width="100%">
<img src="/blog/assets/img/secure-code-ci/juiceshop8.png" alt="juiceshop8" width="100%"></p>

<p>Now we log out of Juicy Shop</p>

<p><img src="/blog/assets/img/secure-code-ci/juicyshop6ac.png" alt="juicyshop6ac" width="100%"></p>

<p>and try to log in with wrong credentials.</p>

<p>We use</p>

<ul>
  <li>User name: <code class="language-plaintext highlighter-rouge">test</code>
</li>
  <li>Password: <code class="language-plaintext highlighter-rouge">test</code>
</li>
</ul>

<p><img src="/blog/assets/img/secure-code-ci/juicyshop6ad.png" alt="juicyshop6ad" width="100%"></p>

<p>And search the POST request in ZAP:</p>

<p><img src="/blog/assets/img/secure-code-ci/juicyshop6a.png" alt="juicyshop6a" width="100%"></p>

<p>Then we click on Response:</p>

<p><img src="/blog/assets/img/secure-code-ci/juicyshop6b.png" alt="juicyshop6b" width="100%"></p>

<p>And save this one:</p>

<p>Right mouse button, ‘Save raw’:</p>

<p><img src="/blog/assets/img/secure-code-ci/juicyshop6d.png" alt="juicyshop6d" width="100%"></p>

<p>‘Response’, ‘All’:</p>

<p><img src="/blog/assets/img/secure-code-ci/juicyshop6e.png" alt="juicyshop6e" width="100%"></p>

<p>We’ll take another text file:</p>

<ul>
  <li>Save As: <code class="language-plaintext highlighter-rouge">response2.out</code>
</li>
  <li>File Format: <code class="language-plaintext highlighter-rouge">Raw</code>
</li>
</ul>

<p><img src="/blog/assets/img/secure-code-ci/juiceshop7.png" alt="juiceshop7" width="100%">
<img src="/blog/assets/img/secure-code-ci/juiceshop7.png" alt="juiceshop8" width="100%"></p>

<p>If we now compare the two responses (e.g. using vim tools <code class="language-plaintext highlighter-rouge">vimdiff response.out.raw response2.out.raw</code>),</p>

<p><img src="/blog/assets/img/secure-code-ci/juicyshop9.png" alt="juicyshop9" width="100%"></p>

<p>we see that a login can be recognized by the occurrence of the string <code class="language-plaintext highlighter-rouge">authentication</code> in the response.</p>

<p>That means we set in Jenkins the following Reg-Ex for the Logged-In Indicator:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">.*\Qauthentication\E.*</code></li>
</ul>

<p><img src="/blog/assets/img/secure-code-ci/juicyshop10.png" alt="juicyshop10" width="100%"></p>

<h5 id="logged-out-string">
<a class="anchor" href="#logged-out-string" aria-hidden="true"><span class="octicon octicon-link"></span></a>Logged-out String</h5>

<p>To determine when we will be logged out, we look at which string can only be found on login page. To do this, hover the mouse over ‘Login’ in the browser, press the right mouse button and examine the element:</p>

<p><img src="/blog/assets/img/secure-code-ci/juicyshoploggedout1.png" alt="juicyshoploggedout1" width="100%"></p>

<p>We use the string <code class="language-plaintext highlighter-rouge">TITLE_LOGIN</code></p>

<p><img src="/blog/assets/img/secure-code-ci/juicyshoploggedout2.png" alt="juicyshoploggedout2" width="100%"></p>

<p>and put it in Jenkins:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">.*\QTITLE_LOGIN\E.*</code></li>
</ul>

<p><img src="/blog/assets/img/secure-code-ci/juicyshoploggedout3.png" alt="juicyshoploggedout3" width="100%"></p>

<h4 id="missing-data">
<a class="anchor" href="#missing-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Missing data</h4>

<p>To complete our scan we enter the following parameters:</p>

<ul>
  <li>Session Properties</li>
  <li>Include in Context: <code class="language-plaintext highlighter-rouge">http://&amp;#x3C;determined_IP&amp;#x3E;:3000/.*</code> e.g. <code class="language-plaintext highlighter-rouge">http://172.17.0.3:3000/.*</code>
</li>
</ul>

<p><img src="/blog/assets/img/secure-code-ci/juicyshopaddmissingdata1.png" alt="juicyshopaddmissingdata1" width="100%"></p>

<p>Authentication should look like this:</p>

<p><img src="/blog/assets/img/secure-code-ci/juicyshopaddmissingdata2.png" alt="juicyshopaddmissingdata2" width="100%"></p>

<p>For the ‘Attack Mode’ we set:</p>

<ul>
  <li>Starting Point: <code class="language-plaintext highlighter-rouge">http://&amp;#x3C;determined_IP&amp;#x3E;:3000/</code>, e.g. <code class="language-plaintext highlighter-rouge">http://172.17.0.3:3000/</code>. Attention: It is important to set the final slash, otherwise the spider and scanner may not work properly.</li>
  <li>Spider Scan</li>
  <li>Recurse: True</li>
  <li>Subtree Only: True</li>
  <li>Max Children To Crawl: <code class="language-plaintext highlighter-rouge">2</code>
</li>
  <li>Active Scan</li>
  <li>Policy: <code class="language-plaintext highlighter-rouge">Default Policy</code>, which scans with MEDIUM strength</li>
  <li>Recurse: True</li>
</ul>

<p><img src="/blog/assets/img/secure-code-ci/juicyshopaddmissingdata3.png" alt="juicyshopaddmissingdata3" width="100%"></p>

<p>Finalize Run’ and the Post-Build actions we leave as usual:</p>

<p><img src="/blog/assets/img/secure-code-ci/juicyshopaddmissingdata4.png" alt="juicyshopaddmissingdata4" width="100%">
<img src="/blog/assets/img/secure-code-ci/juicyshopaddmissingdata5.png" alt="juicyshopaddmissingdata5" width="100%"></p>

<h4 id="start-scan">
<a class="anchor" href="#start-scan" aria-hidden="true"><span class="octicon octicon-link"></span></a>Start Scan</h4>

<p>Now we can start the build / scan. This will take some time.</p>

<p><img src="/blog/assets/img/secure-code-ci/buildnow.png" alt="buildnow">
<img src="/blog/assets/img/secure-code-ci/scanowaspzapjuicyshop.png" alt="scanowaspzapjuicyshop" width="100%"></p>

<h3 id="owasp-web-goat">
<a class="anchor" href="#owasp-web-goat" aria-hidden="true"><span class="octicon octicon-link"></span></a>OWASP Web Goat</h3>

<p>Another application we will use to illustrate authentication is <a href="https://www.owasp.org/index.php/Category:OWASP_WebGoat_Project" target="_blank" rel="noopener noreferrer">OWASP WebGoat</a>.</p>

<p>We’ll launch it with you:</p>

<pre><code class="bash">docker run -p 127.0.0.1:10394:8080 -it webgoat/webgoat-8.0 /home/webgoat/start.sh
open http://127.0.0.1:10394/WebGoat/
</code></pre>

<h4 id="creating-a-user">
<a class="anchor" href="#creating-a-user" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating a user</h4>

<p>First we have to register a user:</p>

<p><img src="/blog/assets/img/secure-code-ci/webgoat_registernewuser1.png" alt="webgoat_registernewuser1" width="100%"></p>

<p>We use</p>

<ul>
  <li>Username: <code class="language-plaintext highlighter-rouge">webgoat</code>
</li>
  <li>Password: <code class="language-plaintext highlighter-rouge">webgoat</code>
</li>
</ul>

<p>accept the terms of service and click on ‘Sign up’:</p>

<p><img src="/blog/assets/img/secure-code-ci/webgoat_registernewuser2.png" alt="webgoat_registernewuser2" width="100%"></p>

<h4 id="logged-in--logged-out-indicators">
<a class="anchor" href="#logged-in--logged-out-indicators" aria-hidden="true"><span class="octicon octicon-link"></span></a>Logged-in / Logged-out Indicators</h4>

<p>When calling the URL <code class="language-plaintext highlighter-rouge">http://127.0.0.1:10394/WebGoat/</code> we are redirected to <code class="language-plaintext highlighter-rouge">http://127.0.0.1:10394/WebGoat/login</code>.</p>

<p>If we now log in with the credentials, have OWASP ZAP recorded, and take a closer look at requests and responses for a successful and unsuccessful login, we see:</p>

<ul>
  <li>Login-Parameter (POST): <code class="language-plaintext highlighter-rouge">username=webgoat&amp;password=webgoat</code>
</li>
  <li>Username Parameter: <code class="language-plaintext highlighter-rouge">username</code>
</li>
  <li>Password Parameter: <code class="language-plaintext highlighter-rouge">password</code>
</li>
  <li>Login-URL: <code class="language-plaintext highlighter-rouge">http://172.17.0.5:8080/WebGoat/login</code>, die IP und Port sind diejenigen im Dockernetz. Beides kann über <code class="language-plaintext highlighter-rouge">docker inspect &lt;containerid_webgoat&gt;|grep "IPA"</code> (IP) bzw aus dem obigen docker-Aufruf ausgelesen werden (Port).</li>
  <li>Username: <code class="language-plaintext highlighter-rouge">webgoat</code>
</li>
  <li>Password: <code class="language-plaintext highlighter-rouge">webgoat</code>
</li>
</ul>

<p>For a successful login:</p>

<p><img src="/blog/assets/img/secure-code-ci/webgoat_loginlogoutindicators1.png" alt="webgoat_loginlogoutindicators1" width="100%">
<img src="/blog/assets/img/secure-code-ci/webgoat_loginlogoutindicator1b.png" alt="webgoat_loginlogoutindicator1b" width="100%"></p>

<p>For a non-successful login:</p>

<p><img src="/blog/assets/img/secure-code-ci/webgoat_loginlogoutindicators2.png" alt="webgoat_loginlogoutindicators2" width="100%">
<img src="/blog/assets/img/secure-code-ci/webgoat_loginlogoutindicators2b.png" alt="webgoat_loginlogoutindicators2b" width="100%"></p>

<p>In the header the location is different:</p>

<p><img src="/blog/assets/img/secure-code-ci/webgoat_loginlogoutindicators3.png" alt="webgoat_loginlogoutindicators3" width="100%"></p>

<p>This is what we use for the Logged-In Indicator:</p>

<p><code class="language-plaintext highlighter-rouge">.*\QLocation: http://172.17.0.5:8080/WebGoat/welcome.mvc\E.*</code></p>

<p><img src="/blog/assets/img/secure-code-ci/webgoat_loginlogoutindicators4.png" alt="webgoat_loginlogoutindicators4" width="100%"></p>

<p>For the Logged-out-Indicator we take the URL of the login page:</p>

<p><code class="language-plaintext highlighter-rouge">.*\Qhttp://127.0.0.5:8080/WebGoat/login\E.*</code></p>

<p>If this is in one of the responses, we assume that the system has logged out the user.</p>

<h4 id="final-setting-webgoat">
<a class="anchor" href="#final-setting-webgoat" aria-hidden="true"><span class="octicon octicon-link"></span></a>Final setting WebGoat</h4>

<p>The final setting for the scan then looks as follows:</p>

<p><img src="/blog/assets/img/secure-code-ci/owaspzapwebgoatfinal2.png" alt="owaspzapwebgoatfinal2" width="100%">
<img src="/blog/assets/img/secure-code-ci/owaspzapwebgoatfinal1.png" alt="owaspzapwebgoatfinal1" width="100%">
<img src="/blog/assets/img/secure-code-ci/owaspzapwebgoatfinal3.png" alt="owaspzapwebgoatfinal3" width="100%">
<img src="/blog/assets/img/secure-code-ci/owaspzapwebgoatfinal4.png" alt="owaspzapwebgoatfinal4" width="100%">
<img src="/blog/assets/img/secure-code-ci/owaspzapwebgoatfinal5.png" alt="owaspzapwebgoatfinal5" width="100%"></p>

<h2 id="best-practices">
<a class="anchor" href="#best-practices" aria-hidden="true"><span class="octicon octicon-link"></span></a>Best Practices</h2>

<p>Due to the duration and traffic such a scan can take, it is recommended to run it only once overnight or once a week.</p>

<p>A daily scan can be set via ‘Build Triggers’:</p>

<p><img src="/blog/assets/img/secure-code-ci/owaspzapjenkinsbestpractices1.png" alt="owaspzapjenkinsbestpractices1" width="100%"></p>

<h1 id="summary">
<a class="anchor" href="#summary" aria-hidden="true"><span class="octicon octicon-link"></span></a>Summary</h1>

<p>This article summarizes how to install and use OWASP ZAP in the Continuous Integration System Jenkins.</p>


            </div>
        </div>
    </div>
</article>

<hr>

<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-md-10 mx-auto">
                <ul class="list-inline text-center">
                    <li class="list-inline-item">
                        <a href="https://secf00tprint.github.io/feed.xml">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                  </span>
                        </a>
                    </li>
                    <li class="list-inline-item">
                        <a href="https://github.com/secf00tprint" target="_blank" rel="noopener noreferrer">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                        </a>
                    </li>
                    <li class="list-inline-item">
                        <a href="https://www.xing.com/profile/Matthias_Altmann9" target="_blank" rel="noopener noreferrer">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fab fa-xing fa-stack-1x fa-inverse"></i>
                  </span>
                        </a>
                    </li>
                </ul>
                <p class="copyright text-muted">©2020 <a href="/blog/legal/legalstuff.html">Legal Stuff</a></p>
            </div>
        </div>
    </div>
</footer>

</body>

</html>
